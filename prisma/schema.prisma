generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Member {
  id            String   @id @default(cuid())
  dni           String   @unique
  memberNumber  String   @unique // N° Socio
  fullName      String
  email         String?  // Email del socio
  phone         String?  // Teléfono
  
  // V7.0: Datos Extendidos (Legacy)
  taxId            String?  @unique // CUIT/CUIL (Nuevo Identificador Principal)
  secondaryEmail   String? // Email secundario (+1)
  alternativePhone String? // Teléfono alternativo (+1)
  addressBilling   String? // Dirección de cobraza
  city             String? // Localidad
  zipCode          String? // Código Postal
  birthDate        DateTime? // Fecha de nacimiento
  joinedAt         DateTime? // Socio desde...

  category      String   // Activo Pleno, Cadete, etc.
  status        String   // ACTIVO - AL DÍA, MOROSO
  seniority     String?  // Antigüedad (e.g. "12 años")
  avatarUrl     String?  // Foto de Perfil
  
  // Digital ID Security
  qrToken       String?  @unique // Token rotativo para QR
  qrExpiresAt   DateTime?
  
  // Entitlements (Derechos de acceso)
  seatLocation  String?  // Platea Norte Baja
  sector        String?  // Sector C - Fila 12
  gate          String?  // Puerta 4
  accessPoint   String?  // Av. La Plata
  
  // Auth para socios
  password      String?  // Hash de contraseña para login socio
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  accessLogs    AccessLog[]
  tickets       Ticket[]
  payments      Payment[]
  familyMembers FamilyMember[]
  notifications Notification[]
  
  // V7.0: Nuevos Módulos
  interactions  Interaction[]
  documents     MemberDocument[]
  bookings      Booking[]
}

model AccessLog {
  id        String   @id @default(cuid())
  memberId  String
  member    Member   @relation(fields: [memberId], references: [id])
  gate      String
  status    String   // GRANTED, DENIED
  timestamp DateTime @default(now())
}

model Match {
  id        String   @id @default(cuid())
  rival     String
  date      DateTime
  time      String
  tournament String
  isClassic Boolean  @default(false)
  isLocal   Boolean  @default(true)
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String   
  role      String   @default("ADMIN") // ADMIN, STAFF
  name      String?
}

model Event {
  id          String   @id @default(cuid())
  title       String   // "San Lorenzo vs Estudiantes RC"
  description String?  // "Liga Profesional de Fútbol"
  category    String   // FUTBOL, REUNION_CD, POLIDEPORTIVO, CIUDAD_DEPORTIVA
  type        String   // MATCH, ABONO, COLONIA, TEMPORADA
  date        DateTime
  location    String   // "Estadio Pedro Bidegain"
  imageUrl    String?
  isActive    Boolean  @default(true)
  sectors     String?  // JSON: ["Popular Local", "Platea Norte", ...]
  payPlans    String?  // JSON: ["1 pago", "3 cuotas", "6 cuotas"]
  maxPerUser  Int      @default(4)
  price       Float?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tickets     Ticket[]
}

model Ticket {
  id         String   @id @default(cuid())
  memberId   String
  member     Member   @relation(fields: [memberId], references: [id])
  eventId    String
  event      Event    @relation(fields: [eventId], references: [id])
  type       String   // ENTRADA, ABONO
  sector     String
  quantity   Int
  payPlan    String?
  status     String   @default("ACTIVE") // ACTIVE, USED, CANCELLED
  createdAt  DateTime @default(now())
}

model Payment {
  id          String   @id @default(cuid())
  memberId    String
  member      Member   @relation(fields: [memberId], references: [id])
  amount      Float
  concept     String   // "Cuota Febrero 2026", "Abono Estadio"
  status      String   // COMPLETED, PENDING, FAILED
  createdAt   DateTime @default(now())
}

model FamilyMember {
  id           String   @id @default(cuid())
  memberId     String
  member       Member   @relation(fields: [memberId], references: [id])
  fullName     String
  relationship String   // "Hijo/a", "Cónyuge", "Padre/Madre"
  memberNumber String?
  category     String?
}

model Notification {
  id        String   @id @default(cuid())
  memberId  String
  member    Member   @relation(fields: [memberId], references: [id])
  title     String
  body      String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
}

// V7.0: Módulo CRM (Interacciones Legacy)
model Interaction {
  id          String   @id @default(cuid())
  memberId    String
  member      Member   @relation(fields: [memberId], references: [id])
  type        String   // CALL, EMAIL, WHATSAPP, IN_PERSON
  category    String   // RECLAMO, CONSULTA, COBRANZA, BIENVENIDA
  subject     String   // "Reclamo cuota", "Consulta abono"
  notes       String?  // Detalle de la interacción
  outcome     String?  // RESUELTO, PENDIENTE, ESCALADO
  staffId     String   // User ID del staff que registró
  createdAt   DateTime @default(now())
}

// V7.0: Módulo Documental (Legajo Digital)
model MemberDocument {
  id          String   @id @default(cuid())
  memberId    String
  member      Member   @relation(fields: [memberId], references: [id])
  type        String   // CONTRATO_ADHESION, APTO_MEDICO, DNI_DIGITAL
  storageUrl  String   // URL del archivo (S3/Blob)
  expirationDate DateTime? // Para aptos médicos
  status      String   @default("PENDING") // PENDING, APPROVED, REJECTED
}
// V7.0: Módulo Gestión de Espacios (Space Management)
model Space {
  id          String    @id @default(cuid())
  name        String    // "Quincho 1", "Cancha Tenis A"
  category    String    // "QUINCHO", "TENIS", "PILETA", "FUTBOL"
  capacity    Int       // Aforo máximo
  price       Float     // Precio base del turno
  isActive    Boolean   @default(true)
  bookings    Booking[]
}

model Booking {
  id          String   @id @default(cuid())
  spaceId     String
  space       Space    @relation(fields: [spaceId], references: [id])
  memberId    String
  member      Member   @relation(fields: [memberId], references: [id])
  date        DateTime // Fecha del turno
  timeSlot    String   // "18:00", "20:00" - Podría mejorar a DateTime range
  status      String   @default("CONFIRMED") // CONFIRMED, CANCELLED, PENDING_PAYMENT
  createdBy   String   @default("MEMBER") // MEMBER, STAFF
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([date, spaceId]) // Optimizar búsqueda de disponibilidad
}
